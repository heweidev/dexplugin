apply plugin: 'java'

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile project(':libloader')
}

sourceCompatibility = "1.7"
targetCompatibility = "1.7"

project.ext {
    BUILD_TOOLS_VERSION = '23.0.3'
    TARGET_SDK_VERSION = 23

    sdkDir = '/home/hewei/Android/Sdk'
    sdk = [:]
    sdk.dex = "$sdkDir/build-tools/$BUILD_TOOLS_VERSION/dx"
}

task dexRelease (type:Exec) {
    inputs.file "${buildDir}/classes/"
    outputs.file "${buildDir}/dex/${project.name}_dex.jar"
    workingDir buildDir
    executable sdk.dex

    //mkdir ${buildDir}/dex

    def argv = []
    argv << '--dex'
    argv << "--output=${buildDir}/dex/${project.name}_dex.jar"
    argv << "${buildDir}/classes/main"

    args = argv
}

task install(type:Exec, dependsOn: 'dexRelease') {
    inputs.file "${buildDir}/dex/${project.name}_dex.jar"

    executable 'adb'

    def argv = []
    argv << 'push'
    argv << "${buildDir}/dex/${project.name}_dex.jar"
    argv << '/sdcard/'

    args = argv
}
